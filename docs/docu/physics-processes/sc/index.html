<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docu/physics-processes/sc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Space Charge | OCELOT</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ocelot-collab.com/docs/docu/physics-processes/sc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Space Charge | OCELOT"><meta data-rh="true" name="description" content="Space Charge class"><meta data-rh="true" property="og:description" content="Space Charge class"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ocelot-collab.com/docs/docu/physics-processes/sc"><link data-rh="true" rel="alternate" href="https://ocelot-collab.com/docs/docu/physics-processes/sc" hreflang="en"><link data-rh="true" rel="alternate" href="https://ocelot-collab.com/docs/docu/physics-processes/sc" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://A7SK3UKMX4-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="OCELOT" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.0b89c045.css">
<script src="/assets/js/runtime~main.53f21ee6.js" defer="defer"></script>
<script src="/assets/js/main.3dfb22bb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OCELOT</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/docu/intro">Documentation</a><a class="navbar__item navbar__link" href="/docs/tutorial/intro">Tutorials</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ocelot-collab/ocelot" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docu/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/ocelot-basics">OCELOT Basics</a><button aria-label="Expand sidebar category &#x27;OCELOT Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/elements">Elements</a><button aria-label="Expand sidebar category &#x27;Elements&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/transfer-maps">Transfer Maps</a><button aria-label="Expand sidebar category &#x27;Transfer Maps&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/physics-processes">Physics Processes</a><button aria-label="Collapse sidebar category &#x27;Physics Processes&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/phys-proc">PhysProc Parent Class</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/docu/physics-processes/sc">Space Charge</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/wake">Wakefields</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/csr">CSR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/ibs">IBS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/slotted-foil">Slotted Foil</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/laser-modulator">LaserModulator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/sr-effect">Spontaneous Radiation Effect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/apertures">Aperture Classes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/beamtransform">BeamTransform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/beam-analysis">Beam Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/chicane">Chicane</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docu/physics-processes/energy-profile">Lattice Energy Profile</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/how-to">How To</a><button aria-label="Expand sidebar category &#x27;How To&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/physics-processes"><span itemprop="name">Physics Processes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Space Charge</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1><a href="https://github.com/ocelot-collab/ocelot/blob/master/ocelot/cpbd/sc.py#L74" target="_blank" rel="noopener noreferrer">SpaceCharge</a> Class</h1></header>
<p>The <a href="https://github.com/ocelot-collab/ocelot/blob/master/ocelot/cpbd/sc.py#L74" target="_blank" rel="noopener noreferrer"><code>SpaceCharge</code></a>  class models the space charge forces in a particle beam by solving the Poisson equation in the bunch frame.
Then the Lorentz transformed electromagnetic field is applied as a kick in the laboratory frame.
For the solution of the Poisson equation we use an integral representation of the electrostatic potential
by convolution of the free-space Green&#x27;s function with the charge distribution.
The convolution equation is solved with the help of the Fast Fourier Transform (FFT). The same algorithm for
solution of the 3D Poisson equation is used, for example, in ASTRA.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parameters">Parameters:<a href="#parameters" class="hash-link" aria-label="Direct link to Parameters:" title="Direct link to Parameters:">​</a></h3>
<ul>
<li><strong>step</strong> (<code>int</code>): Step size used in unit steps. Default is <code>1</code>.</li>
<li><strong>nmesh_xyz</strong> (<code>list</code>): Defines the number of mesh points in each dimension for the 3D mesh. Default is <code>[63, 63, 63]</code>.</li>
<li><strong>low_order_kick</strong> (<code>bool</code>): Whether to use a low-order approximation for the kick. Default is <code>True</code>.</li>
<li><strong>random_mesh</strong> (<code>bool</code>): If <code>True</code>, the mesh is shifted slightly at each step to reduce numerical noise. Default is <code>False</code>.</li>
<li><strong>random_seed</strong> (<code>int</code>): Seed for random number generation when <code>random_mesh</code> is <code>True</code>. Default is <code>10</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="methods">Methods:<a href="#methods" class="hash-link" aria-label="Direct link to Methods:" title="Direct link to Methods:">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="__init__self-step1-kwargs"><code>__init__(self, step=1, **kwargs)</code><a href="#__init__self-step1-kwargs" class="hash-link" aria-label="Direct link to __init__self-step1-kwargs" title="Direct link to __init__self-step1-kwargs">​</a></h4>
<p>Constructor to initialize the <code>SpaceCharge</code> class with the specified parameters. It sets up the mesh, the randomization flag, and the random seed.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prepareself-lat"><code>prepare(self, lat)</code><a href="#prepareself-lat" class="hash-link" aria-label="Direct link to prepareself-lat" title="Direct link to prepareself-lat">​</a></h4>
<p>Prepares the simulation by checking the step size and setting the random seed if necessary.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sym_kernelself-ijk2-hxyz"><code>sym_kernel(self, ijk2, hxyz)</code><a href="#sym_kernelself-ijk2-hxyz" class="hash-link" aria-label="Direct link to sym_kernelself-ijk2-hxyz" title="Direct link to sym_kernelself-ijk2-hxyz">​</a></h4>
<p>Computes the symmetric kernel for the 3D Poisson equation solution using the convolution method. The kernel is used to calculate the electrostatic potential in the beam.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="potentialself-q-steps"><code>potential(self, q, steps)</code><a href="#potentialself-q-steps" class="hash-link" aria-label="Direct link to potentialself-q-steps" title="Direct link to potentialself-q-steps">​</a></h4>
<p>Solves the Poisson equation for the electrostatic potential in the beam, given the charge distribution (<code>q</code>) and step sizes (<code>steps</code>). This method uses the Fast Fourier Transform (FFT) for efficient computation.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="el_fieldself-x-q-gamma-nxyz"><code>el_field(self, X, Q, gamma, nxyz)</code><a href="#el_fieldself-x-q-gamma-nxyz" class="hash-link" aria-label="Direct link to el_fieldself-x-q-gamma-nxyz" title="Direct link to el_fieldself-x-q-gamma-nxyz">​</a></h4>
<p>Calculates the electric field in the rest frame of the bunch by using a 3D interpolation method. The result is Lorentz transformed to the laboratory frame.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="applyself-p_array-zstep"><code>apply(self, p_array, zstep)</code><a href="#applyself-p_array-zstep" class="hash-link" aria-label="Direct link to applyself-p_array-zstep" title="Direct link to applyself-p_array-zstep">​</a></h4>
<p>Applies the space charge kick to the particle array (<code>p_array</code>) over a given path length (<code>zstep</code>). The method computes the electric field and updates the particle momenta according to the space charge forces.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="__repr__self---str"><code>__repr__(self) -&gt; str</code><a href="#__repr__self---str" class="hash-link" aria-label="Direct link to __repr__self---str" title="Direct link to __repr__self---str">​</a></h4>
<p>Returns a string representation of the <code>SpaceCharge</code> class, including key parameters like step size, mesh resolution, and randomization settings.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>The <code>SpaceCharge</code> class simulates the space charge forces acting on a particle beam by solving the Poisson equation for the beam&#x27;s charge distribution. The class computes the electric field using a convolution method and applies the resulting forces as kicks to the particle array. This model is crucial for understanding beam dynamics, especially in high-intensity beams where space charge effects are significant.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-usage">Example Usage<a href="#example-usage" class="hash-link" aria-label="Direct link to Example Usage" title="Direct link to Example Usage">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create a SpaceCharge instance with specified parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">space_charge </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SpaceCharge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">step</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nmesh_xyz</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_mesh</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Prepare the simulation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">space_charge</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prepare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Apply the space charge forces to the particle array `p_array` over a step size `zstep`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">space_charge</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p_array</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zstep</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.01</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Class Documentation</h1>
<p>This section provides documentation for the <code>LSC</code> (Longitudinal Space Charge) class, which models the longitudinal space charge effects in particle beams. The class calculates the wake field impact of the space charge and applies it as a series of kicks to the beam.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lsc-class">LSC Class<a href="#lsc-class" class="hash-link" aria-label="Direct link to LSC Class" title="Direct link to LSC Class">​</a></h2>
<p>The <code>LSC</code> class simulates the longitudinal space charge effects in particle beams. The space charge forces are calculated by solving the Poisson equation in the bunch frame and then applying the resulting electric field in the laboratory frame as a kick. The class uses Fast Fourier Transform (FFT) to efficiently solve the 3D Poisson equation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parameters-1">Parameters:<a href="#parameters-1" class="hash-link" aria-label="Direct link to Parameters:" title="Direct link to Parameters:">​</a></h3>
<ul>
<li><strong>step</strong> (<code>int</code>): Step size used in unit steps. Default is <code>1</code>.</li>
<li><strong>smooth_param</strong> (<code>float</code>): Smoothing parameter for the longitudinal space charge force. Default is <code>0.1</code>.</li>
<li><strong>step_profile</strong> (<code>bool</code>): If <code>True</code>, uses a stepped profile for the beam; otherwise, uses a continuous profile. Default is <code>False</code>.</li>
<li><strong>napply</strong> (<code>int</code>): Counter for the number of times the <code>apply</code> method is called.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="methods-1">Methods:<a href="#methods-1" class="hash-link" aria-label="Direct link to Methods:" title="Direct link to Methods:">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="__init__self-step1"><code>__init__(self, step=1)</code><a href="#__init__self-step1" class="hash-link" aria-label="Direct link to __init__self-step1" title="Direct link to __init__self-step1">​</a></h4>
<p>Constructor to initialize the <code>LSC</code> class with the specified parameters, including the smoothing parameter and step profile option.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="imp_lscself-gamma-sigma-w-dz"><code>imp_lsc(self, gamma, sigma, w, dz)</code><a href="#imp_lscself-gamma-sigma-w-dz" class="hash-link" aria-label="Direct link to imp_lscself-gamma-sigma-w-dz" title="Direct link to imp_lscself-gamma-sigma-w-dz">​</a></h4>
<p>Calculates the longitudinal space charge impedance based on the beam&#x27;s energy (<code>gamma</code>), transverse beam size (<code>sigma</code>), frequency (<code>w</code>), and step size (<code>dz</code>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="imp_step_lscself-gamma-rb-w-dz"><code>imp_step_lsc(self, gamma, rb, w, dz)</code><a href="#imp_step_lscself-gamma-rb-w-dz" class="hash-link" aria-label="Direct link to imp_step_lscself-gamma-rb-w-dz" title="Direct link to imp_step_lscself-gamma-rb-w-dz">​</a></h4>
<p>Calculates the longitudinal space charge impedance in the case of a stepped profile bunch. It considers the transverse beam radius (<code>rb</code>) and other parameters.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="wake2impedanceself-s-w"><code>wake2impedance(self, s, w)</code><a href="#wake2impedanceself-s-w" class="hash-link" aria-label="Direct link to wake2impedanceself-s-w" title="Direct link to wake2impedanceself-s-w">​</a></h4>
<p>Performs a Fourier transform with <code>exp(iwt)</code> to convert the wake function to impedance. <code>s</code> is the position in the bunch, and <code>w</code> is the wake function in V/C.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="impedance2wakeself-f-y"><code>impedance2wake(self, f, y)</code><a href="#impedance2wakeself-f-y" class="hash-link" aria-label="Direct link to impedance2wakeself-f-y" title="Direct link to impedance2wakeself-f-y">​</a></h4>
<p>Performs a Fourier transform with <code>exp(-iwt)</code> to convert the impedance to the wake function. <code>f</code> is the frequency in Hz, and <code>y</code> is the impedance in Ohms.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="wake_lscself-s-bunch-gamma-sigma-dz"><code>wake_lsc(self, s, bunch, gamma, sigma, dz)</code><a href="#wake_lscself-s-bunch-gamma-sigma-dz" class="hash-link" aria-label="Direct link to wake_lscself-s-bunch-gamma-sigma-dz" title="Direct link to wake_lscself-s-bunch-gamma-sigma-dz">​</a></h4>
<p>Calculates the longitudinal space charge wake for the beam, given the bunch distribution, energy (<code>gamma</code>), beam size (<code>sigma</code>), and step size (<code>dz</code>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="applyself-p_array-dz"><code>apply(self, p_array, dz)</code><a href="#applyself-p_array-dz" class="hash-link" aria-label="Direct link to applyself-p_array-dz" title="Direct link to applyself-p_array-dz">​</a></h4>
<p>Applies the longitudinal space charge wake to the particle array (<code>p_array</code>) over a step size (<code>dz</code>). It computes the longitudinal space charge forces and updates the particle momenta.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="__repr__self---str-1"><code>__repr__(self) -&gt; str</code><a href="#__repr__self---str-1" class="hash-link" aria-label="Direct link to __repr__self---str-1" title="Direct link to __repr__self---str-1">​</a></h4>
<p>Returns a string representation of the <code>LSC</code> class, including key parameters like step size, smoothing parameter, and step profile option.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-1">Summary<a href="#summary-1" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>The <code>LSC</code> class models the longitudinal space charge effects in particle beams, including the wake field and impedance. It calculates the space charge forces and applies them as kicks to the beam, updating the particle momenta. This class is useful for simulating beam dynamics where longitudinal space charge effects are significant, such as in high-intensity beams.</p>
<hr>
<h1>LSC Class</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="description">Description:<a href="#description" class="hash-link" aria-label="Direct link to Description:" title="Direct link to Description:">​</a></h3>
<p>The <code>LSC</code> class applies the longitudinal space charge (LSC) effects to a particle beam by calculating the longitudinal space charge wake and applying it to the particle array. The method considers both stepped and smooth beam profiles and uses impedance models to calculate the wake for different beam conditions. The class uses Fourier transforms to convert between wakefields and impedances.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="attributes">Attributes:<a href="#attributes" class="hash-link" aria-label="Direct link to Attributes:" title="Direct link to Attributes:">​</a></h3>
<ul>
<li><strong>smooth_param</strong> (<code>float</code>): A smoothing parameter used to define the resolution. The resolution is calculated as <code>np.std(p_array.tau()) * smooth_param</code>. Default is <code>0.1</code>.</li>
<li><strong>step_profile</strong> (<code>bool</code>): A flag indicating whether the beam has a stepped profile. Default is <code>False</code>.</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="methods-2">Methods:<a href="#methods-2" class="hash-link" aria-label="Direct link to Methods:" title="Direct link to Methods:">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="__init__self-step1-1"><code>__init__(self, step=1)</code><a href="#__init__self-step1-1" class="hash-link" aria-label="Direct link to __init__self-step1-1" title="Direct link to __init__self-step1-1">​</a></h4>
<p>Constructor that initializes the <code>LSC</code> class with the specified step size.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="imp_lscself-gamma-sigma-w-dz-1"><code>imp_lsc(self, gamma, sigma, w, dz)</code><a href="#imp_lscself-gamma-sigma-w-dz-1" class="hash-link" aria-label="Direct link to imp_lscself-gamma-sigma-w-dz-1" title="Direct link to imp_lscself-gamma-sigma-w-dz-1">​</a></h4>
<p>Calculates the longitudinal space-charge impedance for a given set of parameters, including energy (<code>gamma</code>), transverse beam size (<code>sigma</code>), angular frequency (<code>w</code>), and step size (<code>dz</code>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="imp_step_lscself-gamma-rb-w-dz-1"><code>imp_step_lsc(self, gamma, rb, w, dz)</code><a href="#imp_step_lscself-gamma-rb-w-dz-1" class="hash-link" aria-label="Direct link to imp_step_lscself-gamma-rb-w-dz-1" title="Direct link to imp_step_lscself-gamma-rb-w-dz-1">​</a></h4>
<p>Calculates the longitudinal space-charge impedance in the case of a stepped profile bunch. This method is used when the beam has a transverse radius (<code>rb</code>) and frequency spectrum (<code>w</code>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="wake2impedanceself-s-w-1"><code>wake2impedance(self, s, w)</code><a href="#wake2impedanceself-s-w-1" class="hash-link" aria-label="Direct link to wake2impedanceself-s-w-1" title="Direct link to wake2impedanceself-s-w-1">​</a></h4>
<p>Converts wakefield data (<code>w</code>) into impedance using the Fourier transform with <code>exp(iwt)</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="impedance2wakeself-f-y-1"><code>impedance2wake(self, f, y)</code><a href="#impedance2wakeself-f-y-1" class="hash-link" aria-label="Direct link to impedance2wakeself-f-y-1" title="Direct link to impedance2wakeself-f-y-1">​</a></h4>
<p>Converts impedance data (<code>y</code>) into wakefield using the Fourier transform with <code>exp(-iwt)</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="wake_lscself-s-bunch-gamma-sigma-dz-1"><code>wake_lsc(self, s, bunch, gamma, sigma, dz)</code><a href="#wake_lscself-s-bunch-gamma-sigma-dz-1" class="hash-link" aria-label="Direct link to wake_lscself-s-bunch-gamma-sigma-dz-1" title="Direct link to wake_lscself-s-bunch-gamma-sigma-dz-1">​</a></h4>
<p>Calculates the longitudinal space charge wake using the impedance model. This method computes the wakefield for a bunch profile (<code>bunch</code>) with energy (<code>gamma</code>), transverse beam size (<code>sigma</code>), and step size (<code>dz</code>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="applyself-p_array-dz-1"><code>apply(self, p_array, dz)</code><a href="#applyself-p_array-dz-1" class="hash-link" aria-label="Direct link to applyself-p_array-dz-1" title="Direct link to applyself-p_array-dz-1">​</a></h4>
<p>Applies the longitudinal space charge wake to the particle array (<code>p_array</code>) over a step size (<code>dz</code>). This method updates the particle&#x27;s momenta based on the calculated wake.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="finalizeself-args-kwargs"><code>finalize(self, *args, **kwargs)</code><a href="#finalizeself-args-kwargs" class="hash-link" aria-label="Direct link to finalizeself-args-kwargs" title="Direct link to finalizeself-args-kwargs">​</a></h4>
<p>Called at the end of the tracking process. This method can be used for finalizing or saving results related to the LSC effects.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="calcualte_csr_wakesself"><code>calcualte_csr_wakes(self)</code><a href="#calcualte_csr_wakesself" class="hash-link" aria-label="Direct link to calcualte_csr_wakesself" title="Direct link to calcualte_csr_wakesself">​</a></h4>
<p>Calculates the CSR wakes for the entire trajectory. This method uses kernels for CSR effects and stores them for later use in the <code>apply</code> method.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="plot_wakeself-p_array-lam_k1-itr_ra-s1-st"><code>plot_wake(self, p_array, lam_K1, itr_ra, s1, st)</code><a href="#plot_wakeself-p_array-lam_k1-itr_ra-s1-st" class="hash-link" aria-label="Direct link to plot_wakeself-p_array-lam_k1-itr_ra-s1-st" title="Direct link to plot_wakeself-p_array-lam_k1-itr_ra-s1-st">​</a></h4>
<p>Plots the wake of the longitudinal space charge effect at each step. This method is useful for visualizing the wake and particle motion over time.</p>
<hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ocelot-collab/ocelot-collab.github.io/tree/main/docs/docu/physics-processes/sc.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/docu/physics-processes/phys-proc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">PhysProc Parent Class</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/docu/physics-processes/wake"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Wakefields</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#parameters" class="table-of-contents__link toc-highlight">Parameters:</a></li><li><a href="#methods" class="table-of-contents__link toc-highlight">Methods:</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#example-usage" class="table-of-contents__link toc-highlight">Example Usage</a></li><li><a href="#lsc-class" class="table-of-contents__link toc-highlight">LSC Class</a><ul><li><a href="#parameters-1" class="table-of-contents__link toc-highlight">Parameters:</a></li><li><a href="#methods-1" class="table-of-contents__link toc-highlight">Methods:</a></li></ul></li><li><a href="#summary-1" class="table-of-contents__link toc-highlight">Summary</a><ul><li><a href="#description" class="table-of-contents__link toc-highlight">Description:</a></li><li><a href="#attributes" class="table-of-contents__link toc-highlight">Attributes:</a></li><li><a href="#methods-2" class="table-of-contents__link toc-highlight">Methods:</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/tutorial/intro">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/docu/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ocelot-collab/ocelot" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 OCELOT, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>