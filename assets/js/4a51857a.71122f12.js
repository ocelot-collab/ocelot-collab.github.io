"use strict";(self.webpackChunkocelot_website=self.webpackChunkocelot_website||[]).push([[4801],{4269:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tutorial/tutorial-beam-dynamics/for_students","title":"15. OCELOT for students","description":"Build intuition","source":"@site/docs/tutorial/tutorial-beam-dynamics/for_students.md","sourceDirName":"tutorial/tutorial-beam-dynamics","slug":"/tutorial/tutorial-beam-dynamics/for_students","permalink":"/docs/tutorial/tutorial-beam-dynamics/for_students","draft":false,"unlisted":false,"editUrl":"https://github.com/ocelot-collab/ocelot-collab.github.io/tree/main/docs/tutorial/tutorial-beam-dynamics/for_students.md","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"sidebar_position":15,"title":"15. OCELOT for students","description":"Build intuition"},"sidebar":"tutorialSidebar","previous":{"title":"14. Useful OCELOT functions","permalink":"/docs/tutorial/tutorial-beam-dynamics/small_useful_features"},"next":{"title":"16. Design HeRes Optics","permalink":"/docs/tutorial/tutorial-beam-dynamics/optics_design"}}');var a=t(4848),s=t(8453);const l={sidebar_position:15,title:"15. OCELOT for students",description:"Build intuition"},o="Ocelot for Students",r={},d=[{value:"Duplet",id:"duplet",level:2},{value:"Create a Simple Lattice",id:"create-a-simple-lattice",level:2},{value:"Plot Beta Functions",id:"plot-beta-functions",level:2},{value:"png",id:"png",level:2},{value:"Visualize Transverse Beam Dynamics",id:"visualize-transverse-beam-dynamics",level:2},{value:"png",id:"png-1",level:2},{value:"Bending Magnet: Dispersion Example",id:"bending-magnet-dispersion-example",level:2},{value:"Lattice with a Dipole",id:"lattice-with-a-dipole",level:3},{value:"Dispersion Visualization",id:"dispersion-visualization",level:3}];function p(e){const n={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("small",{children:(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.em,{children:["This notebook was created by Sergey Tomin (",(0,a.jsx)(n.a,{href:"mailto:sergey.tomin@desy.de",children:"sergey.tomin@desy.de"}),"). April 2025."]})})}),"\n",(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"ocelot-for-students",children:(0,a.jsx)(n.a,{href:"https://github.com/ocelot-collab/ocelot/blob/dev/demos/ipython_tutorials/interactive_beamline.ipynb",children:"Ocelot for Students"})})}),"\n",(0,a.jsxs)(n.p,{children:["This ",(0,a.jsx)(n.a,{href:"https://github.com/ocelot-collab/ocelot/blob/dev/demos/ipython_tutorials/interactive_beamline.ipynb",children:"tutorial"})," is aimed at students and beginners in accelerator physics.",(0,a.jsx)(n.br,{}),"\n","The idea is to keep it simple and interactive, helping you build intuition about how magnetic elements work."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"duplet",children:"Duplet"}),"\n",(0,a.jsx)(n.p,{children:"We\u2019ll start with a basic beamline: a Drift and two Quadrupoles (focusing and defocusing)."}),"\n",(0,a.jsx)(n.p,{children:"First, import the necessary modules:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from ocelot import *\nfrom ocelot.gui import *\nfrom ipywidgets import interact, FloatSlider\nimport copy\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udca1 ",(0,a.jsx)(n.strong,{children:"Tip:"})," If you don\u2019t have ",(0,a.jsx)(n.code,{children:"ipywidgets"}),", run:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pip install ipywidgets\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"create-a-simple-lattice",children:"Create a Simple Lattice"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"d = Drift(l=1.)\nqf = Quadrupole(l=0.2, k1=1)\nqd = Quadrupole(l=0.2, k1=-1)\ncell = [d, qf, d, qd, d]\n\nlat = MagneticLattice(cell)\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"plot-beta-functions",children:"Plot Beta Functions"}),"\n",(0,a.jsxs)(n.p,{children:["Here we define a function to calculate and display the beta functions.",(0,a.jsx)(n.br,{}),"\n","You can interactively change the quadrupole strengths to see how the optics evolve."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def plot_betas(qf_k1=1.0, qd_k1=-1.0):\n    qf.k1 = qf_k1\n    qd.k1 = qd_k1\n\n    tws0 = Twiss(beta_x=10, beta_y=10, alpha_x=0, alpha_y=0)\n    tws = twiss(lat, tws0, nPoints=20)\n\n    sb = [tw.s for tw in tws]\n    bx = [tw.beta_x for tw in tws]\n    by = [tw.beta_y for tw in tws]\n\n    fig, ax_xy = plot_API(lat, fig_name="Beta-functions", legend=False)\n    ax_xy.plot(sb, bx, "C1", label=r"$\\beta_x$")\n    ax_xy.plot(sb, by, "C2", label=r"$\\beta_y$")\n    ax_xy.set_ylabel(r"$\\beta_{x,y}$ [m]")\n    ax_xy.set_xlabel("S [m]")\n    ax_xy.legend()\n    plt.show()\n'})}),"\n",(0,a.jsx)(n.p,{children:"Interactive widget:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# Create interactive sliders for the parameters\ninteract(\n    plot_betas,\n    qf_k1=FloatSlider(min=-20, max=20, step=0.1, value=1.0),\n    qd_k1=FloatSlider(min=-20, max=20, step=0.1, value=-1.0),\n)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"png",children:(0,a.jsx)(n.img,{alt:"png",src:t(9321).A+"",width:"1508",height:"1184"})}),"\n",(0,a.jsx)(n.h2,{id:"visualize-transverse-beam-dynamics",children:"Visualize Transverse Beam Dynamics"}),"\n",(0,a.jsx)(n.p,{children:"Let\u2019s now visualize how particles with small transverse offsets propagate through the lattice."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def plot_beam(qf_k1=1.0, qd_k1=-1.0):\n    qf.k1 = qf_k1\n    qd.k1 = qd_k1\n\n    x_coors = np.linspace(-0.01, 0.01, num=10)\n    y_coors = np.linspace(-0.01, 0.01, num=10)\n\n    p_list = [Particle(x=x, y=y) for x, y in zip(x_coors, y_coors)]\n    P = [copy.deepcopy(p_list)]\n    navi = Navigator(lat)\n    dz = 0.01\n\n    for _ in range(int(lat.totalLen / dz)):\n        tracking_step(lat, p_list, dz=dz, navi=navi)\n        P.append(copy.deepcopy(p_list))\n\n    fig, (ax_x, ax_y) = plt.subplots(2, 1, figsize=(10, 6), sharex=True)\n    fig.suptitle("Particle Trajectories with Transverse Offsets")\n\n    for i in range(len(p_list)):\n        s = [p[i].s for p in P]\n        x = [p[i].x for p in P]\n        y = [p[i].y for p in P]\n        ax_x.plot(s, x, "C0")\n        ax_y.plot(s, y, "C1")\n\n    ax_x.set_ylabel("X [m]")\n    ax_y.set_ylabel("Y [m]")\n    ax_y.set_xlabel("S [m]")\n    ax_x.grid(True)\n    ax_y.grid(True)\n    plt.tight_layout(rect=[0, 0.03, 1, 0.95])\n    plt.show()\n'})}),"\n",(0,a.jsx)(n.p,{children:"Add the interactive widget:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# Create interactive sliders for the parameters\ninteract(\n    plot_beam,\n    qf_k1=FloatSlider(min=-20, max=20, step=0.1, value=1.0),\n    qd_k1=FloatSlider(min=-20, max=20, step=0.1, value=-1.0),\n)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"png-1",children:(0,a.jsx)(n.img,{alt:"png",src:t(6045).A+"",width:"2070",height:"1272"})}),"\n",(0,a.jsx)(n.h2,{id:"bending-magnet-dispersion-example",children:"Bending Magnet: Dispersion Example"}),"\n",(0,a.jsx)(n.p,{children:"A quick look at how horizontal position depends on momentum deviation \u2014 the concept of dispersion."}),"\n",(0,a.jsx)(n.h3,{id:"lattice-with-a-dipole",children:"Lattice with a Dipole"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"d = Drift(l=1)\nb = Bend(l=0.5, angle=5/180*np.pi)\ncell = [d, b, d]\nlat2 = MagneticLattice(cell)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"dispersion-visualization",children:"Dispersion Visualization"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def plot_beam_dipole(angle=0.01, dip_l=0.5):\n    b.angle = angle * np.pi / 180\n    b.l = dip_l\n    print(f"Lattice length: {lat2.totalLen:.2f} m")\n\n    p_coors = np.linspace(-0.01, 0.01, num=10)\n    p_list = [Particle(x=0, y=0, p=p, E=1) for p in p_coors]\n    P = [copy.deepcopy(p_list)]\n\n    navi = Navigator(lat2)\n    dz = 0.01\n\n    for _ in range(int(lat2.totalLen / dz)):\n        tracking_step(lat2, p_list, dz=dz, navi=navi)\n        P.append(copy.deepcopy(p_list))\n\n    fig, (ax_x, ax_p) = plt.subplots(2, 1, figsize=(10, 6), sharex=True)\n    fig.suptitle("Effect of Dispersion in a Dipole Magnet")\n\n    for i in range(len(p_list)):\n        s = [p[i].s for p in P]\n        x = [p[i].x for p in P]\n        p_vals = [p[i].p for p in P]\n\n        ax_x.plot(s, x)\n        ax_p.plot(s, p_vals, "C0")\n\n    ax_x.set_ylabel("X [m]")\n    ax_p.set_ylabel("Relative Momentum p")\n    ax_p.set_xlabel("S [m]")\n    ax_x.set_ylim([-0.0025, 0.0025])\n    ax_x.grid(True)\n    ax_p.grid(True)\n    plt.tight_layout(rect=[0, 0.03, 1, 0.95])\n    plt.show()\n'})}),"\n",(0,a.jsx)(n.p,{children:"Widget:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# Create interactive sliders for the parameters\ninteract(\n    plot_beam_dipole,\n    angle=FloatSlider(min=-10, max=10, step=0.05, value=1.0),\n    dip_l=FloatSlider(min=0, max=2, step=0.1, value=1),\n)\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"png",src:t(4984).A+"",width:"2038",height:"1318"})})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},9321:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/betas-5b7b930442cbaa1539d0e1ca5121be3d.png"},4984:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/p-4a3ba50351687265278209b20c1a41b7.png"},6045:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/traj-be47ee2db36cb8bc4625061ab97d9a3c.png"},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var i=t(6540);const a={},s=i.createContext(a);function l(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);