"use strict";(self.webpackChunkocelot_website=self.webpackChunkocelot_website||[]).push([[5443],{2141:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"docu/OCELOT fundamentals/survey","title":"Survey","description":"Ocelot MachineLayout - Survey and 2D/3D Layout Plotting","source":"@site/docs/docu/OCELOT fundamentals/survey.md","sourceDirName":"docu/OCELOT fundamentals","slug":"/docu/OCELOT fundamentals/survey","permalink":"/docs/docu/OCELOT fundamentals/survey","draft":false,"unlisted":false,"editUrl":"https://github.com/ocelot-collab/ocelot-collab.github.io/tree/main/docs/docu/OCELOT fundamentals/survey.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11,"title":"Survey","description":"Ocelot MachineLayout - Survey and 2D/3D Layout Plotting"},"sidebar":"docsSidebar","previous":{"title":"Matching","permalink":"/docs/docu/OCELOT fundamentals/matching"},"next":{"title":"Elements","permalink":"/docs/category/elements"}}');var s=i(4848),l=i(8453);const r={sidebar_position:11,title:"Survey",description:"Ocelot MachineLayout - Survey and 2D/3D Layout Plotting"},c="MachineLayout: Survey and 2D/3D Layout Plotting",o={},d=[{value:"Overview",id:"overview",level:2},{value:"Requirements",id:"requirements",level:2},{value:"<code>MagneticLattice.survey()</code>",id:"magneticlatticesurvey",level:2},{value:"Simple usage of <code>survey()</code>",id:"simple-usage-of-survey",level:3},{value:"Why do we need <code>MachineLayout</code>?",id:"why-do-we-need-machinelayout",level:2},{value:"<code>MachineLayout</code> class",id:"machinelayout-class",level:2},{value:"Key semantics",id:"key-semantics",level:3},{value:"Methods",id:"methods",level:3},{value:"Stored data",id:"stored-data",level:3},{value:"Example of multi beamline layout",id:"example-of-multi-beamline-layout",level:2},{value:"Add a branch line",id:"add-a-branch-line",level:2},{value:"Build the facility graph",id:"build-the-facility-graph",level:2},{value:"Run survey and inspect output",id:"run-survey-and-inspect-output",level:2},{value:"Inspect one element record",id:"inspect-one-element-record",level:2},{value:"Visualization concepts",id:"visualization-concepts",level:2},{value:"2D visualization",id:"2d-visualization",level:3},{value:"3D visualization (Plotly)",id:"3d-visualization-plotly",level:3},{value:"Visualization-only element attributes",id:"visualization-only-element-attributes",level:2},{value:"Interference checks",id:"interference-checks",level:2},{value:"Practical tips",id:"practical-tips",level:2},{value:"1) Using <code>tilt</code>",id:"1-using-tilt",level:3},{value:"2) Choosing <code>width</code> and <code>height</code>",id:"2-choosing-width-and-height",level:3},{value:"3) Anchor semantics for branches",id:"3-anchor-semantics-for-branches",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsxs)(n.h1,{id:"machinelayout-survey-and-2d3d-layout-plotting",children:[(0,s.jsx)(n.a,{href:"https://github.com/ocelot-collab/ocelot/blob/dev/ocelot/cpbd/layout.py",children:"MachineLayout"}),": Survey and 2D/3D Layout Plotting"]})}),"\n",(0,s.jsx)(n.p,{children:"This document explains the concepts behind the Ocelot survey and layout tools and how they are intended to be used."}),"\n",(0,s.jsx)(n.p,{children:"It covers:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Beamline geometry surveys using ",(0,s.jsx)(n.a,{href:"https://www.ocelot-collab.com/docs/docu/OCELOT%20fundamentals/magnet-lattice",children:(0,s.jsx)(n.code,{children:"MagneticLattice"})})]}),"\n",(0,s.jsx)(n.li,{children:"The meaning of survey output data"}),"\n",(0,s.jsxs)(n.li,{children:["Why and when to use the higher-level ",(0,s.jsx)(n.a,{href:"https://github.com/ocelot-collab/ocelot/blob/dev/ocelot/cpbd/layout.py",children:(0,s.jsx)(n.code,{children:"MachineLayout"})})]}),"\n",(0,s.jsx)(n.li,{children:"2D and 3D visualization concepts"}),"\n",(0,s.jsx)(n.li,{children:"Interference (collision) checks"}),"\n",(0,s.jsx)(n.li,{children:"Practical usage tips"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The focus here is on ",(0,s.jsx)(n.strong,{children:"concepts and data structures"}),", not on code details."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["In Ocelot, the geometric layout of a beamline or facility is described using a ",(0,s.jsx)(n.strong,{children:"survey"}),".\nA survey computes the ",(0,s.jsx)(n.strong,{children:"global positions and orientations"})," of beamline elements starting from a given reference point."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key idea:"}),(0,s.jsx)(n.br,{}),"\n","The survey determines where the beamline is in the global laboratory frame and how it is oriented at each point."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Core survey and layout functionality requires only Ocelot and its numerical dependencies."}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"2D plotting"})," relies on standard plotting libraries."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"3D plotting (optional)"})," requires ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"https://plotly.com",children:"Plotly"})}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.a,{href:"https://plotly.com",children:"Plotly"})," is not installed, all survey functionality and 2D visualization remain available."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"https://plotly.com",children:"Plotly"})," is used only for interactive 3D visualization and is intentionally kept outside ",(0,s.jsx)(n.code,{children:"ocelot.cpbd"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from ocelot import *\n\n# New survey class / plotting\nfrom ocelot.cpbd.layout import MachineLayout\nfrom ocelot.gui.layout_2d import plot_layout_2d\nfrom ocelot.gui.layout_3d import plot_layout_3d\n"})}),"\n",(0,s.jsx)(n.p,{children:"initializing ocelot..."}),"\n",(0,s.jsx)(n.h2,{id:"magneticlatticesurvey",children:(0,s.jsx)(n.code,{children:"MagneticLattice.survey()"})}),"\n",(0,s.jsxs)(n.p,{children:["Before introducing the higher-level ",(0,s.jsx)(n.code,{children:"MachineLayout"}),", it is important to understand the\n",(0,s.jsx)(n.strong,{children:"low-level geometric survey"})," provided by\n",(0,s.jsx)(n.a,{href:"https://www.ocelot-collab.com/docs/docu/OCELOT%20fundamentals/magnet-lattice",children:(0,s.jsx)(n.code,{children:"MagneticLattice"})}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["For a complete description of the survey algorithm, returned data structures, and\nconventions, see the\n",(0,s.jsx)(n.a,{href:"https://www.ocelot-collab.com/docs/docu/OCELOT%20fundamentals/magnet-lattice",children:(0,s.jsx)(n.code,{children:"MagneticLattice.survey()"})}),"\nmethod documentation."]}),"\n",(0,s.jsxs)(n.p,{children:["Here we only consider a ",(0,s.jsx)(n.strong,{children:"simple example"})," showing how to call ",(0,s.jsx)(n.code,{children:"survey()"})," and how to\ninterpret and visualize the resulting survey data."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h3,{id:"simple-usage-of-survey",children:["Simple usage of ",(0,s.jsx)(n.code,{children:"survey()"})]}),"\n",(0,s.jsxs)(n.p,{children:["For a single beamline, ",(0,s.jsx)(n.code,{children:"MagneticLattice.survey()"})," is sufficient to:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"inspect global positions and orientations"}),"\n",(0,s.jsx)(n.li,{children:"verify bending and tilt behavior"}),"\n",(0,s.jsx)(n.li,{children:"produce simple 2D plots (e.g. top or side views)"}),"\n",(0,s.jsx)(n.li,{children:"debug element geometry"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"At this level, the user works directly with the lists of survey dictionaries returned\nby the method."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import matplotlib.pyplot as plt\nlat = MagneticLattice([\n    Drift(l=5, eid="d1"),\n    Quadrupole(l=0.5, eid="q1"),\n    SBend(l=2.0, angle=0.3, eid="b1"),\n    Drift(l=4, eid="d2"),\n])\n\nmid, end = lat.survey()\n\nprint("Number of records:", len(end))\nprint("Keys in one record:")\nprint(end[0].keys())\n\n# simple matplotlib plotting\n\n# Extract centerline points\nX = [p["r_start"][0] for p in end]\nZ = [p["r_start"][2] for p in end]\n\n# add final exit point\nX.append(end[-1]["r_end"][0])\nZ.append(end[-1]["r_end"][2])\n\nplt.figure(figsize=(8, 3))\nplt.plot(Z, X, "-o")\nplt.xlabel("Z [m]")\nplt.ylabel("X [m]")\nplt.title("Simple top view from MagneticLattice.survey()")\nplt.grid(True)\nplt.tight_layout()\nplt.show()\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"    Number of records: 5\n    Keys in one record:\n    dict_keys(['LENGTH', 'TILT', 'S', 'X', 'Y', 'Z', 'THETA', 'PHI', 'PSI', 'XPD', 'YPD', 'ZPD', 'W', 'W_start', 'r_start', 'r_end', 'element'])\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"png",src:i(7002).A+"",width:"790",height:"290"})}),"\n",(0,s.jsxs)(n.h2,{id:"why-do-we-need-machinelayout",children:["Why do we need ",(0,s.jsx)(n.code,{children:"MachineLayout"}),"?"]}),"\n",(0,s.jsxs)(n.p,{children:["While ",(0,s.jsx)(n.code,{children:"MagneticLattice.survey()"})," works well for a ",(0,s.jsx)(n.strong,{children:"single beamline"}),", it becomes\ninconvenient when dealing with more complex layouts."]}),"\n",(0,s.jsx)(n.p,{children:"Typical limitations include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["no native support for ",(0,s.jsx)(n.strong,{children:"multiple beamlines"})]}),"\n",(0,s.jsxs)(n.li,{children:["no notion of ",(0,s.jsx)(n.strong,{children:"branching"})]}),"\n",(0,s.jsx)(n.li,{children:"manual handling of global coordinates"}),"\n",(0,s.jsx)(n.li,{children:"no automatic interference checks"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["To address these use cases, Ocelot provides the higher-level class ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"MachineLayout"})}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"machinelayout-class",children:[(0,s.jsx)(n.code,{children:"MachineLayout"})," class"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"MachineLayout"})," is a high-level container for the ",(0,s.jsx)(n.strong,{children:"geometric layout of a facility"})," composed of multiple\nbeamlines (",(0,s.jsx)(n.code,{children:"MagneticLattice"}),"), including branches. It is built on top of ",(0,s.jsx)(n.code,{children:"MagneticLattice.survey()"})," and follows\nMAD-8 survey conventions for position/orientation propagation."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"MachineLayout"})," is ",(0,s.jsx)(n.strong,{children:"geometry-only"}),": it does not affect tracking or optics. Its purpose is to:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"survey several beamlines in a common global frame,"}),"\n",(0,s.jsx)(n.li,{children:"connect child lines to a parent line at a named anchor element,"}),"\n",(0,s.jsx)(n.li,{children:"support facility-level plotting (2D/3D) and coarse interference checks."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"key-semantics",children:"Key semantics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Survey-driven geometry:"})," all positions/orientations come from ",(0,s.jsx)(n.code,{children:"MagneticLattice.survey()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Explicit branching:"})," a child line attaches to a parent line by ",(0,s.jsx)(n.code,{children:"anchor_element_id"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Endpoint anchoring:"})," branching always happens at the ",(0,s.jsx)(n.strong,{children:"exit"})," of the anchor element (",(0,s.jsx)(n.code,{children:"r_end"}),", ",(0,s.jsx)(n.code,{children:"W"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parent-first evaluation:"})," surveys are computed in parent-first order (independent of ",(0,s.jsx)(n.code,{children:"add_line()"})," order)."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"methods",children:"Methods"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"add_line(name, lattice, parent_name=None, anchor_element_id=None)"})}),(0,s.jsx)(n.br,{}),"\n","Register a beamline. If ",(0,s.jsx)(n.code,{children:"parent_name"})," is given, the beamline is treated as a branch starting at the\nexit of ",(0,s.jsx)(n.code,{children:"anchor_element_id"})," in the parent line."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"survey()"})}),(0,s.jsx)(n.br,{}),"\n","Compute surveys for all registered lines in parent-first order and cache the results in ",(0,s.jsx)(n.code,{children:"self._surveys"}),".\nReturns a dictionary ",(0,s.jsx)(n.code,{children:"{line_name: end_survey_data}"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"check_interferences(min_distance=0.1)"})}),(0,s.jsx)(n.br,{}),"\n","Coarse collision check between beamlines. Computes the minimum distance between element centerline\nsegments and compares it to an effective radius based on element ",(0,s.jsx)(n.code,{children:"width"})," (fallback to ",(0,s.jsx)(n.code,{children:"min_distance"}),")."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"stored-data",children:"Stored data"}),"\n",(0,s.jsxs)(n.p,{children:["After calling ",(0,s.jsx)(n.code,{children:"survey()"}),", survey results are available via:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"self._surveys[line_name]"})," \u2192 the ",(0,s.jsx)(n.strong,{children:"endpoint survey list"})," for that line."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"example-of-multi-beamline-layout",children:"Example of multi beamline layout"}),"\n",(0,s.jsxs)(n.p,{children:["We start with main beam line, for this we initialize new ",(0,s.jsx)(n.code,{children:"MagneticLattice"})," object"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Notes in Ocelot version >25.12 we have new atributes for elements ",(0,s.jsx)(n.code,{children:"width"}),", ",(0,s.jsx)(n.code,{children:"height"}),", ",(0,s.jsx)(n.code,{children:"color"})," are purely for plotting/visualization of survey function:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# Main beamline (root)\nmain_linac = MagneticLattice([\n    Drift(l=5, eid="d1", width=0.05, height=0.05),   # cylinder-like in 3D\n    Quadrupole(l=0.5, eid="q1", width=0.25, height=0.25, color="red"),\n    Drift(l=1, eid="d2"),\n    SBend(l=2, angle=0.25, eid="b1", width=0.35, height=0.35, color="steelblue"),\n    Drift(l=3, eid="d3"),\n    Quadrupole(l=0.5, eid="q2", width=0.25, height=0.25, color="red"),\n])\n'})}),"\n",(0,s.jsx)(n.p,{children:"Note:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"width"}),", ",(0,s.jsx)(n.code,{children:"height"}),", ",(0,s.jsx)(n.code,{children:"color"})," are purely for plotting/visualization."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SBend(..., angle=...)"})," determines curvature in survey geometry."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"tilt"})," rotates around the local s-axis (e.g. skew quad or vertical bend)."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"add-a-branch-line",children:"Add a branch line"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# A branch (child) beamline that starts after some element in the parent line\ndump_line = MagneticLattice([\n    Drift(l=1, eid="dd1"),\n    SBend(l=2, angle=0.45, eid="db1", tilt=np.pi/2, width=0.30, height=0.30, color="crimson"),  # "vertical" bend\n    Drift(l=4, eid="dd2"),\n])\n'})}),"\n",(0,s.jsx)(n.h2,{id:"build-the-facility-graph",children:"Build the facility graph"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'facility = MachineLayout()\n\nfacility.add_line("Main", main_linac)\n\n# Attach Dump after element "b1" in Main\nfacility.add_line("Dump", dump_line, parent_name="Main", anchor_element_id="b1")\n'})}),"\n",(0,s.jsx)(n.h2,{id:"run-survey-and-inspect-output",children:"Run survey and inspect output"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'surveys = facility.survey()\n\nprint("Lines computed:", list(surveys.keys()))\nprint("Number of records in Main:", len(surveys["Main"]))\nprint("Keys of one record:", list(surveys["Main"][0].keys()))\n'})}),"\n",(0,s.jsx)(n.p,{children:"Lines computed: ['Main', 'Dump']\nNumber of records in Main: 7\nKeys of one record: ['LENGTH', 'TILT', 'S', 'X', 'Y', 'Z', 'THETA', 'PHI', 'PSI', 'XPD', 'YPD', 'ZPD', 'W', 'W_start', 'r_start', 'r_end', 'element']"}),"\n",(0,s.jsx)(n.h2,{id:"inspect-one-element-record",children:"Inspect one element record"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'rec = surveys["Main"][3]  # pick any record\nel = rec["element"]\n\nprint("Element:", el.__class__.__name__, el.id)\nprint("r_start:", rec["r_start"])\nprint("r_end  :", rec["r_end"])\n\nW = rec["W"]\nprint("W[:,2] (beam direction) =", W[:,2])\n'})}),"\n",(0,s.jsx)(n.p,{children:"Element: Drift d2\nr_start: [0.  0.  5.5]\nr_end  : [0.  0.  6.5]\nW[:,2] (beam direction) = [0. 0. 1.]"}),"\n",(0,s.jsx)(n.h2,{id:"visualization-concepts",children:"Visualization concepts"}),"\n",(0,s.jsx)(n.h3,{id:"2d-visualization",children:"2D visualization"}),"\n",(0,s.jsx)(n.p,{children:"2D plotting typically provides:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Top view:"})," X vs Z"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Side view:"})," Y vs Z"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This representation is well suited for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"quick geometry checks"}),"\n",(0,s.jsx)(n.li,{children:"publications and reports"}),"\n",(0,s.jsx)(n.li,{children:"debugging beamline curvature"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Aspect ratios can be enforced so that transverse dimensions are not distorted."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'fig, (ax_top, ax_side) = plot_layout_2d(\n    facility,\n    show_orbit=True,\n    show_elements=True,\n    equal_aspect=True,\n    title="Facility Layout (2D: Top + Side)"\n)\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"png",src:i(8350).A+"",width:"1189",height:"788"})}),"\n",(0,s.jsxs)(n.h3,{id:"3d-visualization-plotly",children:["3D visualization (",(0,s.jsx)(n.a,{href:"https://plotly.com",children:"Plotly"}),")"]}),"\n",(0,s.jsx)(n.p,{children:"3D visualization provides an intuitive representation of the entire facility:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"reference trajectories are drawn as lines"}),"\n",(0,s.jsx)(n.li,{children:"elements are rendered as boxes or cylinders"}),"\n",(0,s.jsx)(n.li,{children:"visual dimensions are controlled via element attributes"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Important implementation details:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["element bodies are positioned using ",(0,s.jsx)(n.code,{children:"r_start"})," and ",(0,s.jsx)(n.code,{children:"W_start"})]}),"\n",(0,s.jsx)(n.li,{children:"X and Y axes are scaled equally so that round elements remain round"}),"\n",(0,s.jsx)(n.li,{children:"element geometry is rigidly attached to the beamline orientation"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"visualization-only-element-attributes",children:"Visualization-only element attributes"}),"\n",(0,s.jsxs)(n.p,{children:["Starting from Ocelot version \u2265 25.12, elements support additional attributes used\n",(0,s.jsx)(n.strong,{children:"only for visualization"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"width"})})," \u2014 transverse size in the x-direction"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"height"})})," \u2014 transverse size in the y-direction"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"color"})})," \u2014 display color for plotting"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["These attributes do ",(0,s.jsx)(n.strong,{children:"not"})," affect beam dynamics or tracking."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'fig = plot_layout_3d(\n    facility,\n    show_orbit=True,\n    show_elements=True,\n    title="Facility Layout (3D)"\n)\nfig.show()\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"png",src:i(9445).A+"",width:"2584",height:"766"})}),"\n",(0,s.jsx)(n.h2,{id:"interference-checks",children:"Interference checks"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"check_interferences()"})," computes minimum distance between element centerline segments of different beamlines."]}),"\n",(0,s.jsxs)(n.p,{children:["This is a ",(0,s.jsx)(n.strong,{children:"coarse"})," check (segment-to-segment distance + width-based radius), but very useful to catch obvious overlaps."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'collisions = facility.check_interferences(min_distance=0.10)\n\nif collisions:\n    print(f" Found {len(collisions)} collisions:")\n    for (lineA, elA, lineB, elB, dist) in collisions:\n        print(f"  {lineA}.{elA} <-> {lineB}.{elB}  dist={dist:.4f} m")\nelse:\n    print(" No collisions detected.")\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"      Found 3 collisions:\n      Main.b1 <-> Dump.dd1  dist=0.0000 m\n      Main.d3 <-> Dump.dd1  dist=0.0000 m\n      Main.d3 <-> Dump.db1  dist=0.0000 m\n"})}),"\n",(0,s.jsx)(n.h2,{id:"practical-tips",children:"Practical tips"}),"\n",(0,s.jsxs)(n.h3,{id:"1-using-tilt",children:["1) Using ",(0,s.jsx)(n.code,{children:"tilt"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Quad: ",(0,s.jsx)(n.code,{children:"tilt = \u03c0/4"})," \u2192 skew quad (visual + optics meaning)"]}),"\n",(0,s.jsxs)(n.li,{children:["Bend: ",(0,s.jsx)(n.code,{children:"tilt = \u03c0/2"})," \u2192 vertical bend (survey & visual)"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"2-choosing-width-and-height",children:["2) Choosing ",(0,s.jsx)(n.code,{children:"width"})," and ",(0,s.jsx)(n.code,{children:"height"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use physical magnet yoke size if you want realistic pictures."}),"\n",(0,s.jsxs)(n.li,{children:["If you just want readability, pick a few standard sizes:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"drifts/cavities: ~0.1\u20130.2 m"}),"\n",(0,s.jsx)(n.li,{children:"quads/sexts: ~0.2\u20130.4 m"}),"\n",(0,s.jsx)(n.li,{children:"bends: ~0.3\u20130.6 m"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-anchor-semantics-for-branches",children:"3) Anchor semantics for branches"}),"\n",(0,s.jsxs)(n.p,{children:["A child line starts at the ",(0,s.jsx)(n.strong,{children:"exit"})," of the anchor element in the parent line and inherits the parent\u2019s orientation at that point."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},9445:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/3d_plot-5333db1f9a6c5fb0ebe3ce02df9d57c8.png"},8350:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/Survey_15_0-f83b56259476ea68b7b75c5870130886.png"},7002:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/Survey_3_1-6b8d1b7349833c60ef1160e1d56dd2d6.png"},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var t=i(6540);const s={},l=t.createContext(s);function r(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);